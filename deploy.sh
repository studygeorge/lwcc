#!/bin/bash

# ะกะบัะธะฟั ะฑััััะพะณะพ ะดะตะฟะปะพั LWCC ะฝะฐ ัะตัะฒะตั

echo "๐ ะะฐัะธะฝะฐะตะผ ะดะตะฟะปะพะน LWCC..."
echo ""

# ะฆะฒะตัะฐ ะดะปั ะฒัะฒะพะดะฐ
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# ะะตัะตัะพะด ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
echo -e "${YELLOW}๐ ะะตัะตัะพะด ะฒ /home/lwcc...${NC}"
cd /home/lwcc || { echo -e "${RED}โ ะัะธะฑะบะฐ: ะดะธัะตะบัะพัะธั /home/lwcc ะฝะต ะฝะฐะนะดะตะฝะฐ${NC}"; exit 1; }

# ะะพะปััะตะฝะธะต ะฟะพัะปะตะดะฝะธั ะธะทะผะตะฝะตะฝะธะน
echo -e "${YELLOW}๐ฅ ะะพะปััะตะฝะธะต ะฟะพัะปะตะดะฝะธั ะธะทะผะตะฝะตะฝะธะน ะธะท Git...${NC}"
git pull origin main || { echo -e "${RED}โ ะัะธะฑะบะฐ ะฟัะธ ะฟะพะปััะตะฝะธะธ ะธะทะผะตะฝะตะฝะธะน${NC}"; exit 1; }
echo -e "${GREEN}โ ะะทะผะตะฝะตะฝะธั ะฟะพะปััะตะฝั${NC}"
echo ""

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ััะพะฝัะตะฝะดะฐ
echo -e "${YELLOW}๐ฆ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ััะพะฝัะตะฝะดะฐ...${NC}"
cd front
npm install || { echo -e "${RED}โ ะัะธะฑะบะฐ ะฟัะธ ัััะฐะฝะพะฒะบะต ะทะฐะฒะธัะธะผะพััะตะน${NC}"; exit 1; }
echo -e "${GREEN}โ ะะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั${NC}"
echo ""

# ะกะฑะพัะบะฐ ััะพะฝัะตะฝะดะฐ
echo -e "${YELLOW}๐จ ะกะฑะพัะบะฐ ััะพะฝัะตะฝะดะฐ ะดะปั production...${NC}"
npm run build || { echo -e "${RED}โ ะัะธะฑะบะฐ ะฟัะธ ัะฑะพัะบะต${NC}"; exit 1; }
echo -e "${GREEN}โ ะคัะพะฝัะตะฝะด ัะพะฑัะฐะฝ${NC}"
echo ""

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะฑะพัะฐ
echo -e "${YELLOW}๐ฆ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะฑะพัะฐ...${NC}"
cd ../bottg
npm install || { echo -e "${RED}โ ะัะธะฑะบะฐ ะฟัะธ ัััะฐะฝะพะฒะบะต ะทะฐะฒะธัะธะผะพััะตะน ะฑะพัะฐ${NC}"; exit 1; }
echo -e "${GREEN}โ ะะฐะฒะธัะธะผะพััะธ ะฑะพัะฐ ัััะฐะฝะพะฒะปะตะฝั${NC}"
echo ""

# ะะตัะตะทะฐะฟััะบ ะฑะพัะฐ
echo -e "${YELLOW}๐ ะะตัะตะทะฐะฟััะบ Telegram ะฑะพัะฐ...${NC}"
if command -v pm2 &> /dev/null; then
    npm run pm2:restart 2>/dev/null || npm run pm2:start
    echo -e "${GREEN}โ ะะพั ะฟะตัะตะทะฐะฟััะตะฝ${NC}"
else
    echo -e "${YELLOW}โ๏ธ  PM2 ะฝะต ัััะฐะฝะพะฒะปะตะฝ, ะฟัะพะฟััะบะฐะตะผ ะฟะตัะตะทะฐะฟััะบ ะฑะพัะฐ${NC}"
fi
echo ""

# ะัะพะฒะตัะบะฐ Nginx
if command -v nginx &> /dev/null; then
    echo -e "${YELLOW}๐ ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ Nginx...${NC}"
    nginx -t && {
        echo -e "${GREEN}โ ะะพะฝัะธะณััะฐัะธั Nginx ะบะพััะตะบัะฝะฐ${NC}"
        echo -e "${YELLOW}๐ ะะตัะตะทะฐะฟััะบ Nginx...${NC}"
        systemctl restart nginx && echo -e "${GREEN}โ Nginx ะฟะตัะตะทะฐะฟััะตะฝ${NC}"
    } || echo -e "${RED}โ ะัะธะฑะบะฐ ะฒ ะบะพะฝัะธะณััะฐัะธะธ Nginx${NC}"
else
    echo -e "${YELLOW}โ๏ธ  Nginx ะฝะต ัััะฐะฝะพะฒะปะตะฝ${NC}"
fi
echo ""

echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}๐ ะะตะฟะปะพะน ััะฟะตัะฝะพ ะทะฐะฒะตััะตะฝ!${NC}"
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "๐ ะคัะพะฝัะตะฝะด ัะพะฑัะฐะฝ ะฒ: ${YELLOW}/home/lwcc/front/build/${NC}"
echo -e "๐ค ะกัะฐััั ะฑะพัะฐ: ${YELLOW}npm run pm2:status${NC}"
echo -e "๐ ะะพะณะธ ะฑะพัะฐ: ${YELLOW}npm run pm2:logs${NC}"
echo ""
